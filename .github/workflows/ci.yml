---
# CI workflow using ci-framework reusable workflow
# Replaces standalone jobs with centralized, maintained ci-framework patterns
name: CI

on:
  push:
    branches: [main, development]
  pull_request:
    branches: [main, development]
  workflow_dispatch:

jobs:
  # Main CI workflow using ci-framework reusable workflow
  ci:
    name: "CI (Framework)"
    uses: Claire-s-Monster/ci-framework/.github/workflows/reusable-ci.yml@main
    with:
      # Pixi environment configuration
      pixi-environment: "ci"

      # Simplified matrix for this project
      python-versions: '["3.11", "3.12"]'
      os-matrix: '["ubuntu-latest"]'

      # Disable features not needed for MCP server
      enable-performance: false
      enable-release: false

      # Enable hygiene checks
      enable-hygiene-check: true

    secrets: inherit

  # Legacy compatibility: Keep ci-success job for branch protection rules
  ci-success:
    name: "CI Success"
    runs-on: ubuntu-latest
    needs: [ci]
    if: always()
    steps:
      - name: "Check CI workflow passed"
        run: |
          if [ "${{ needs.ci.result }}" != "success" ]; then
            echo "CI framework workflow failed"
            exit 1
          fi
          echo "All CI checks passed via ci-framework!"
